<div class="min-h-screen bg-white text-gray-900" data-controller="competition-compare">
  <header class="border-b border-gray-200 px-4 py-3">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-2xl font-serif text-blue-700">Phone Comparison</h1>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6">
    <%# Insights summary %>
    <% if @insights.present? %>
      <div class="mb-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
        <h2 class="text-lg font-serif mb-4 text-blue-900">Comparison Insights</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <p class="text-sm text-gray-600">Cheapest Option</p>
            <p class="text-2xl font-bold text-green-700">
              <%= number_to_currency(@insights[:cheapest][:avg_price]) %>
            </p>
            <p class="text-sm text-gray-700"><%= @insights[:cheapest][:phone][:full_name] %></p>
          </div>
          <div>
            <p class="text-sm text-gray-600">Most Expensive</p>
            <p class="text-2xl font-bold text-red-700">
              <%= number_to_currency(@insights[:most_expensive][:avg_price]) %>
            </p>
            <p class="text-sm text-gray-700"><%= @insights[:most_expensive][:phone][:full_name] %></p>
          </div>
          <div>
            <p class="text-sm text-gray-600">Price Range</p>
            <p class="text-2xl font-bold text-blue-700">
              <%= number_to_currency(@insights[:price_range]) %>
            </p>
            <p class="text-sm text-gray-600"><%= @insights[:coverage_summary] %></p>
          </div>
        </div>
      </div>
    <% end %>

    <%# Phone selection form %>
    <div class="mb-6">
      <label for="phone-select" class="block text-sm font-medium text-gray-700 mb-2">
        Select phones to compare (<%= DashboardConstants::COMPARISON_MIN_PHONES %>-<%= DashboardConstants::COMPARISON_MAX_PHONES %> phones)
      </label>
      <%= form_tag competition_compare_path, method: :get, class: 'flex gap-2' do %>
        <%= select_tag 'phone_ids',
            options_from_collection(@phones, :id, :full_name),
            multiple: true,
            class: 'flex-1 border-gray-300 rounded-md shadow-sm px-3 py-2' %>
        <%= submit_tag 'Compare',
            class: 'bg-blue-600 text-white px-4 py-2 rounded-md font-medium hover:bg-blue-700 transition' %>
      <% end %>
    </div>

    <%# Comparison table %>
    <% if @comparison_data.present? %>
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Feature</th>
              <% @comparison_data.each do |phone| %>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-900 uppercase tracking-wider">
                  <%= phone[:brand] %><br><%= phone[:model] %>
                </th>
              <% end %>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            <%# Price row %>
            <tr class="bg-blue-50">
              <td class="px-4 py-2 font-medium text-gray-900">Average Price</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-blue-700 font-bold">
                  <%= number_to_currency(phone[:avg_price]) %>
                </td>
              <% end %>
            </tr>

            <%# Market position %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Market Position</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2">
                  <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium
                    <%= case phone[:market_position]
                      when 'premium' then 'bg-green-100 text-green-800'
                      when 'mid-range' then 'bg-yellow-100 text-yellow-800'
                      else 'bg-gray-100 text-gray-800' %>">
                    <%= phone[:market_position].humanize %>
                  </span>
                </td>
              <% end %>
            </tr>

            <%# Screen size %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Screen</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-gray-900">
                  <%= phone[:screen_size] || 'N/A' %>
                </td>
              <% end %>
            </tr>

            <%# Battery %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Battery</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-gray-900">
                  <%= phone[:battery] || 'N/A' %>
                </td>
              <% end %>
            </tr>

            <%# Camera %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Camera</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-gray-900">
                  <%= phone[:camera] || 'N/A' %>
                </td>
              <% end %>
            </tr>

            <%# Storage %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Storage</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-gray-900">
                  <%= phone[:storage] || 'N/A' %>
                </td>
              <% end %>
            </tr>

            <%# Price points %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Price Points</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-gray-700">
                  <%= phone[:price_points] %> points
                </td>
              <% end %>
            </tr>

            <%# Competitors %>
            <tr>
              <td class="px-4 py-2 text-gray-600">Competitors</td>
              <% @comparison_data.each do |phone| %>
                <td class="px-4 py-2 text-gray-700">
                  <%= phone[:competitor_count] %> phones
                </td>
              <% end %>
            </tr>
          </tbody>
        </table>
      </div>
    <% end %>
  </main>
</div>
